<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %> - Skopos</title>

    <link rel="icon" type="image/x-icon" href="/img/favicon.ico">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsvectormap@1.7.0/dist/jsvectormap.min.css">

    <link rel="stylesheet" href="/css/style.css?v=<%= appUpdated %>">

    <script>
      (function() {
        const DEFAULT_SETTINGS = {
          theme: 'light',
          refreshRate: 60000,
          autoRefresh: true,
          dataPeriod: 7,
          resultsLimit: 10,
          sidebarCollapsed: false,
          toastsEnabled: true,
          showUniqueVisitors: false,
          timezone: 'UTC',
          overviewDataPeriod: 7,
          overviewResultsLimit: 10,
          overviewShowUniqueVisitors: false
        };
        let settings = { ...DEFAULT_SETTINGS };
        try {
          const stored = localStorage.getItem('skopos-settings');
          if (stored) {
            settings = { ...DEFAULT_SETTINGS, ...JSON.parse(stored) };
          }
        } catch (e) {
          console.error('Failed to load settings:', e);
        }
        document.documentElement.setAttribute('data-theme', settings.theme);
        window.__SKOPOS_SETTINGS__ = settings;
        window.__COUNTRY_NAMES__ = <%- typeof countryNames !== 'undefined' ? JSON.stringify(countryNames) : '{}' %>;
        
        if (settings.sidebarCollapsed) {
          document.documentElement.classList.add('sidebar-collapsed-init');
        }

        document.addEventListener('DOMContentLoaded', function() {
          document.addEventListener('click', function(e) {
            const link = e.target.closest('a');
            if (link && !link.dataset.noIntercept) {
              const href = link.getAttribute('href');
              if (href && !href.includes('?')) {
                if (href === '/' || href === '/overview') {
                  e.preventDefault();
                  const url = new URL(href, window.location.origin);
                  url.searchParams.set('period', settings.overviewDataPeriod || 7);
                  url.searchParams.set('limit', settings.overviewResultsLimit || 10);
                  window.location.href = url.toString();
                }
                else if (href.startsWith('/dashboard/') && !href.includes('/dashboard/seo') && !href.includes('/dashboard/report')) {
                  e.preventDefault();
                  const url = new URL(href, window.location.origin);
                  url.searchParams.set('period', settings.dataPeriod);
                  url.searchParams.set('limit', settings.resultsLimit);
                  window.location.href = url.toString();
                }
              }
            }
          });
        });
      })();
    </script>
  </head>
  
  <body>