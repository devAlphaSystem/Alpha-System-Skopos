<%- include('partials/header', {title: 'Manage Websites'}) %>

<%- include('partials/mobile-header') %>

<div class="page-wrapper">
  <%- include('partials/sidebar', { websites, archivedWebsites, currentWebsite, currentPage }) %>
  <div class="main-container">
    <header class="main-header">
      <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle Sidebar"><i class="fa-solid fa-bars"></i></button>
      <div class="header-content">
        <div class="header-title">
          <h1>Manage Websites</h1>
          <p>Add, view, or remove your tracked websites</p>
        </div>
      </div>
    </header>
    
    <main class="main-content" style="padding-top: 1rem;">
      <div class="websites-grid">
        <div class="card">
          <div class="card-header">
            <h2>Add New Website</h2>
          </div>
          <form class="website-form" action="/websites" method="POST">
            <div class="form-group">
              <label for="name">Website Name</label>
              <input type="text" id="name" name="name" placeholder="My Awesome Blog" required>
            </div>
            <div class="form-group">
              <label for="domain">Domain</label>
              <input type="text" id="domain" name="domain" placeholder="example.com" required>
            </div>
            <div class="form-group">
              <label for="dataRetentionDays">Data Retention (days)</label>
              <input type="number" id="dataRetentionDays" name="dataRetentionDays" placeholder="0" min="0" value="0">
              <p class="form-hint">Set to 0 to keep data forever.</p>
            </div>
            <button type="submit" class="btn">Add Website</button>
          </form>
        </div>
        
        <div class="card">
          <div class="card-header">
            <h2>Your Websites</h2>
          </div>
          <% if (websites.length > 0) { %>
            <div class="website-list">
              <% for (const website of websites) { %>
                <div class="card website-item-card">
                  <div class="website-card-header">
                    <h3><a href="/dashboard/<%= website.id %>"><%= website.name %></a></h3>
                    <form action="/websites/archive/<%= website.id %>" method="POST">
                      <button type="submit" class="btn archive-website-btn" data-website-name="<%= website.name %>"><i class="fa-solid fa-box-archive"></i> Archive</button>
                    </form>
                  </div>
                  <div class="website-card-body">
                    <p><strong>Domain:</strong> <%= website.domain %></p>
                    <p><strong>Retention:</strong> <%= website.dataRetentionDays > 0 ? `${website.dataRetentionDays} days` : 'Forever' %></p>
                  </div>
                  <div class="website-card-footer">
                    <div class="tracking-id-container">
                      <code><%= website.trackingId %></code>
                      <button class="copy-btn" onclick="copyToClipboard('<%= website.trackingId %>', this)" title="Copy Tracking ID"><i class="fa-solid fa-copy"></i></button>
                    </div>
                  </div>
                </div>
              <% } %>
            </div>
          <% } else { %>
            <p>You haven't added any websites yet. Add one using the form.</p>
          <% } %>

          <% if (archivedWebsites.length > 0) { %>
            <div class="card-header" style="margin-top: 2rem;">
              <h2>Archived Websites</h2>
            </div>
            <div class="website-list">
              <% for (const website of archivedWebsites) { %>
                <div class="card website-item-card">
                  <div class="website-card-header">
                    <h3><a href="/dashboard/<%= website.id %>"><%= website.name %></a></h3>
                    <div class="header-actions">
                      <form action="/websites/restore/<%= website.id %>" method="POST" style="display: inline-block; margin-right: 0.5rem;">
                        <button type="submit" class="btn restore-website-btn" data-website-name="<%= website.name %>"><i class="fa-solid fa-box-open"></i> Restore</button>
                      </form>
                      <form action="/websites/delete/<%= website.id %>" method="POST" style="display: inline-block;">
                        <button type="submit" class="btn btn-danger delete-website-btn" data-website-name="<%= website.name %>"><i class="fa-solid fa-trash"></i> Delete Permanently</button>
                      </form>
                    </div>
                  </div>
                  <div class="website-card-body">
                    <p><strong>Domain:</strong> <%= website.domain %></p>
                    <p><strong>Archived on:</strong> <%= new Date(website.updated).toLocaleDateString() %></p>
                  </div>
                </div>
              <% } %>
            </div>
          <% } %>
        </div>
      </div>
    </main>
  </div>
</div>

<script>
  function copyToClipboard(text, button) {
    navigator.clipboard.writeText(text).then(() => {
      const originalIcon = button.innerHTML;
      button.innerHTML = '<i class="fa-solid fa-check"></i>';
      setTimeout(() => {
        button.innerHTML = originalIcon;
      }, 2000);
    });
  }
</script>

<%- include('partials/footer', { scripts: [] }) %>