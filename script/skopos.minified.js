var Ne=Object.defineProperty,Oe=Object.defineProperties;var Le=Object.getOwnPropertyDescriptors;var ae=Object.getOwnPropertySymbols;var Fe=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable;var ce=(i,c,h)=>c in i?Ne(i,c,{enumerable:!0,configurable:!0,writable:!0,value:h}):i[c]=h,S=(i,c)=>{for(var h in c||(c={}))Fe.call(c,h)&&ce(i,h,c[h]);if(ae)for(var h of ae(c))xe.call(c,h)&&ce(i,h,c[h]);return i},T=(i,c)=>Oe(i,Le(c));((i,c,h,y,L)=>{var ie;const B=c.currentScript;if(!B)return;const g=e=>B.getAttribute(e),l={siteId:g("data-site-id")||"",host:(g("data-host")||"").replace(/\/+$/,""),autoTrack:g("data-auto-track")!=="false",trackErrors:g("data-track-errors")!=="false",trackOutbound:g("data-track-outbound")!=="false",trackDownloads:g("data-track-downloads")!=="false",hashMode:g("data-hash-mode")==="true",respectDnt:g("data-respect-dnt")==="true",debug:g("data-debug")==="true",batchInterval:Math.max(1e3,Number.parseInt(g("data-batch-interval"),10)||5e3),maxBatchSize:Math.min(50,Math.max(1,Number.parseInt(g("data-max-batch-size"),10)||10)),sessionTimeout:Math.max(6e4,Number.parseInt(g("data-session-timeout"),10)||18e5)};if(!l.siteId){console.warn("[Skopos] Missing required data-site-id attribute");return}if(!l.host){console.warn("[Skopos] Missing required data-host attribute");return}if(l.respectDnt&&(h.doNotTrack==="1"||i.doNotTrack==="1")){l.debug&&console.log("[Skopos] Do Not Track enabled, analytics disabled"),i.skopos=()=>{};return}const V=`${l.host}/collect`,k="_sk_",K=`${k}sid`,j=`${k}vid`,J=`${k}la`,F=`${k}q`,ue=100,le=50,W=/\.(pdf|zip|rar|7z|tar|gz|dmg|exe|msi|doc|docx|xls|xlsx|ppt|pptx|csv|mp3|mp4|avi|mov|webm)(?:[?#]|$)/i,Y="sk0p0s_4n4lyt1cs_0bf_k3y_2026";function fe(e){try{const t=JSON.stringify(e),n=Y.length;let r="";for(let o=0;o<t.length;o++){const a=t.charCodeAt(o)^Y.charCodeAt(o%n);r+=String.fromCharCode(a)}return btoa(unescape(encodeURIComponent(r)))}catch(t){return null}}const f=l.debug?(...e)=>console.log("[Skopos]",...e):()=>{},x=(...e)=>console.warn("[Skopos]",...e);function G(){try{const e=new Uint8Array(16);return(i.crypto||i.msCrypto).getRandomValues(e),Array.from(e,t=>t.toString(16).padStart(2,"0")).join("").slice(0,24)}catch(e){let t="";for(let n=0;n<24;n++)t+=Math.floor(Math.random()*16).toString(16);return t}}function M(e){try{return localStorage.getItem(e)}catch(t){return null}}function q(e,t){try{return localStorage.setItem(e,t),!0}catch(n){return!1}}function X(e){try{return localStorage.removeItem(e),!0}catch(t){return!1}}function H(e){try{return sessionStorage.getItem(e)}catch(t){return null}}function Z(e,t){try{return sessionStorage.setItem(e,t),!0}catch(n){return!1}}function de(){let e=M(j);return(!e||typeof e!="string"||e.length<16)&&(e=G(),q(j,e)),e}function w(){const e=Date.now();let t=H(K);const n=Number.parseInt(H(J),10)||0;return(!t||typeof t!="string"||t.length<16||n>0&&e-n>l.sessionTimeout)&&(t=G(),Z(K,t)),Z(J,String(e)),t}function p(e,t=2048){if(e==null)return"";let n=e;if(typeof n!="string")try{n=String(n)}catch(o){return""}let r="";for(let o=0;o<n.length;o++){const a=n.charCodeAt(o);(a>=32&&a<127||a>159)&&(r+=n[o])}return r.trim().slice(0,t)}function _(e,t=5,n=0){if(n>=t||e==null)return null;if(typeof e=="string")return p(e,1024);if(typeof e=="number")return Number.isFinite(e)?e:null;if(typeof e=="boolean")return e;if(Array.isArray(e))return e.slice(0,100).map(r=>_(r,t,n+1)).filter(r=>r!=null);if(typeof e=="object"){const r={},o=Object.keys(e).slice(0,50);for(const a of o){const u=p(a,128);if(u){const d=_(e[a],t,n+1);d!=null&&(r[u]=d)}}return r}return null}function z(e){if(typeof e!="string")return null;try{const t=JSON.parse(e);return t&&typeof t=="object"?t:null}catch(t){return null}}function he(e){if(!e||typeof e!="string")return!1;try{return new URL(e,y.href).hostname.toLowerCase()!==y.hostname.toLowerCase()}catch(t){return!1}}function pe(e){if(!e||typeof e!="string")return!1;try{const t=new URL(e,y.href).pathname;return W.test(t)}catch(t){return W.test(e)}}function ge(){return l.hashMode?y.hash.slice(1)||"/":y.pathname+y.search}function ye(){return y.href}function me(){const e=h.userAgent;return!!(!e||typeof e!="string"||/bot|crawl|spider|scrape|headless|phantom|selenium|puppeteer|playwright|prerender|lighthouse/i.test(e)||h.webdriver===!0||i._phantom||i.__nightmare||i.callPhantom)}const s={visitorId:de(),sessionId:w(),lastPath:null,pageEntryTime:Date.now(),totalActiveTime:0,lastActiveTime:Date.now(),isVisible:!c.hidden,hasTrackedExit:!1,eventQueue:[],errorQueue:new Map,flushTimer:null,errorFlushTimer:null,initialized:!1,identifiedUser:null,isFlushing:!1};function A(){var e,t;return{sid:l.siteId,vid:s.visitorId,ssid:s.sessionId,url:p(ye(),4096),ref:p(c.referrer,2048),sw:((e=i.screen)==null?void 0:e.width)||0,sh:((t=i.screen)==null?void 0:t.height)||0,vw:i.innerWidth||0,vh:i.innerHeight||0,lang:(h.language||"").slice(0,10),tz:(()=>{try{return Intl.DateTimeFormat().resolvedOptions().timeZone||""}catch(n){return""}})(),ts:Date.now()}}function E(e,t=!1){if(!e)return!1;let n;try{const r=fe(e);if(!r)return f("Failed to obfuscate payload"),!1;n=JSON.stringify({_d:r,_v:1})}catch(r){return f("Failed to serialize payload:",r),!1}if(f("Sending:",e),t&&h.sendBeacon)try{const r=new Blob([n],{type:"application/json"});if(h.sendBeacon(V,r))return!0}catch(r){f("sendBeacon failed:",r)}try{return fetch(V,{method:"POST",headers:{"Content-Type":"application/json"},body:n,keepalive:!0,mode:"cors",credentials:"omit"}).catch(r=>{f("Fetch failed:",r),ee(e)}),!0}catch(r){return f("Request failed:",r),ee(e),!1}}function ee(e){try{const t=z(M(F))||[];if(!Array.isArray(t))return;for(t.push(e);t.length>le;)t.shift();q(F,JSON.stringify(t))}catch(t){f("Failed to store request:",t)}}function ke(){try{const e=z(M(F));if(!Array.isArray(e)||e.length===0)return;X(F);for(const t of e)t&&typeof t=="object"&&E(t)}catch(e){f("Failed to retry requests:",e)}}function U(e){e&&(s.eventQueue.push(e),s.eventQueue.length>=l.maxBatchSize?C():s.flushTimer||(s.flushTimer=setTimeout(C,l.batchInterval)))}function C(e=!1){if(s.flushTimer&&(clearTimeout(s.flushTimer),s.flushTimer=null),s.eventQueue.length===0||s.isFlushing)return;s.isFlushing=!0;const t=s.eventQueue.slice();s.eventQueue.length=0,s.isFlushing=!1;const n=T(S({},A()),{type:"batch",events:t});E(n,e)}function te(){if(s.isVisible){const e=Date.now(),t=e-s.lastActiveTime;t>0&&t<l.sessionTimeout&&(s.totalActiveTime+=t),s.lastActiveTime=e}}function ve(){te();const e=Math.round(s.totalActiveTime/1e3);return Math.max(0,Math.min(e,86400))}function P(){s.pageEntryTime=Date.now(),s.totalActiveTime=0,s.lastActiveTime=Date.now(),s.isVisible=!c.hidden,s.hasTrackedExit=!1}function v(e=!1){const t=ge();if(t===s.lastPath)return;s.lastPath=t,s.sessionId=w();const n={t:"pv",p:p(t,2048)};if(e||!s.initialized){const r=T(S({},A()),{type:"batch",events:[n]});E(r)}else U(n);f("Page view:",t)}function re(e,t={}){if(!e||typeof e!="string"){x("Event name must be a non-empty string");return}const n={t:"ev",n:p(e,255)};if(t&&typeof t=="object"&&!Array.isArray(t)){const r=_(t);if(r)try{JSON.stringify(r).length<=8192&&(n.d=r)}catch(o){x("Invalid event data")}}U(n),f("Event:",e,t)}function I(e="leave"){if(s.hasTrackedExit)return;s.hasTrackedExit=!0;const t=ve();if(t<1)return;C(!0);const n=T(S({},A()),{type:"exit",dur:t,reason:p(e,32)});E(n,!0),f("Page exit:",e,`${t}s`)}function R(e,t,n,r,o){if(!l.trackErrors)return;const a=p(e||"Unknown error",512),u=p(t||"",4096),d=u.split(`
`)[1]||"",m=`${a}|${d}`,b=s.errorQueue.get(m);if(b){b.count=Math.min(b.count+1,1e4);return}s.errorQueue.size>=ue&&N(),s.errorQueue.set(m,{msg:a,stack:u,src:p(n||"",512),line:typeof r=="number"&&Number.isFinite(r)?r:0,col:typeof o=="number"&&Number.isFinite(o)?o:0,count:1}),s.errorFlushTimer||(s.errorFlushTimer=setTimeout(N,1e4)),f("Error tracked:",e)}function N(e=!1){if(s.errorFlushTimer&&(clearTimeout(s.errorFlushTimer),s.errorFlushTimer=null),s.errorQueue.size===0)return;const t=Array.from(s.errorQueue.values());s.errorQueue.clear();const n=T(S({},A()),{type:"errors",errors:t});E(n,e)}function be(e){!l.trackOutbound||!e||(U({t:"out",u:p(e,2048)}),f("Outbound:",e))}function Se(e){var n;if(!l.trackDownloads||!e)return;let t="";try{t=new URL(e,y.href).pathname.split("/").pop()||""}catch(r){t=((n=e.split("/").pop())==null?void 0:n.split("?")[0])||""}U({t:"dl",f:p(t,255),u:p(e,2048)}),f("Download:",t)}function Ee(e,t={}){if(!e||typeof e!="string"){x("User ID must be a non-empty string");return}s.identifiedUser={id:p(e,255)};const n={uid:s.identifiedUser.id};if(t&&typeof t=="object"&&(t.name&&(n.name=p(t.name,255)),t.email&&(n.email=p(t.email,255)),t.phone&&(n.phone=p(t.phone,50)),t.metadata&&typeof t.metadata=="object")){const o=_(t.metadata);if(o)try{JSON.stringify(o).length<=4096&&(n.meta=o)}catch(a){f("Invalid metadata:",a)}}const r=S(T(S({},A()),{type:"identify"}),n);E(r),f("Identify:",e,t)}function Q(e){if(!e||!e.querySelectorAll)return;let t;try{t=e.querySelectorAll("[skopos-event]:not([skopos-bound])")}catch(n){return}for(const n of t){const r=n.getAttribute("skopos-event");if(!r)continue;const o=n.getAttribute("skopos-event-on")||"click";n.addEventListener(o,()=>{let a={};const u=n.getAttribute("skopos-data");if(u){const m=z(u);m&&!Array.isArray(m)&&(a=m)}const d=n.getAttribute("skopos-data-from");if(d){const m=d.split(",");for(const b of m){const D=b.indexOf(":");if(D===-1)continue;const oe=b.slice(0,D).trim(),$=b.slice(D+1).trim();if(oe&&$)try{const O=c.querySelector($);if(O){const Ie="value"in O?O.value:O.textContent;a[oe]=(Ie||"").trim()}}catch(O){f("Invalid selector:",$)}}}re(r,a)}),n.setAttribute("skopos-bound","true")}}function Te(e){if(!e||!e.target)return;const t=e.target.closest?e.target.closest("a[href]"):null;if(!t)return;const n=t.getAttribute("href");if(!n||n.startsWith("#")||n.startsWith("javascript:")||n.startsWith("mailto:")||n.startsWith("tel:"))return;let r;try{r=new URL(n,y.href).href}catch(o){return}pe(r)?Se(r):he(r)&&be(r)}function ne(e,...t){if(typeof e=="string")switch(e){case"event":re(t[0],t[1]);break;case"pageview":v();break;case"identify":Ee(t[0],t[1]);break;case"opt-out":q(`${k}optout`,"1"),i.skopos=()=>{};break;case"opt-in":X(`${k}optout`);try{y.reload()}catch(n){}break;case"debug":l.debug=t[0]!==!1;break;default:x("Unknown command:",e)}}function se(){var n;if(s.initialized)return;if(M(`${k}optout`)==="1"){f("User opted out"),i.skopos=()=>{};return}if(me()){f("Bot detected, skipping"),i.skopos=()=>{};return}s.initialized=!0;const e=((n=i.skopos)==null?void 0:n.q)||[];if(i.skopos=ne,ke(),l.autoTrack){c.readyState==="complete"?v(!0):i.addEventListener("load",()=>v(!0),{once:!0});const r=L.pushState;L.pushState=function(...a){I("navigate");const u=r.apply(this,a);return P(),setTimeout(v,0),u};const o=L.replaceState;L.replaceState=function(...a){const u=o.apply(this,a);return setTimeout(v,0),u},i.addEventListener("popstate",()=>{I("navigate"),P(),v()}),l.hashMode&&i.addEventListener("hashchange",()=>{I("navigate"),P(),v()})}c.addEventListener("visibilitychange",()=>{c.hidden?(te(),s.isVisible=!1,C(!0),N(!0)):(s.isVisible=!0,s.lastActiveTime=Date.now())}),i.addEventListener("pagehide",()=>{I("leave"),N(!0)}),i.addEventListener("beforeunload",()=>{I("leave"),N(!0)}),l.trackErrors&&(i.addEventListener("error",r=>{var o,a;if(r instanceof ErrorEvent){const u=r.message||((o=r.error)==null?void 0:o.message)||"Unknown error",d=((a=r.error)==null?void 0:a.stack)||"";R(u,d,r.filename,r.lineno,r.colno)}else if(r.target&&(r.target.tagName==="SCRIPT"||r.target.tagName==="LINK"||r.target.tagName==="IMG")){const u=r.target.src||r.target.href||"unknown";R(`Failed to load ${r.target.tagName.toLowerCase()}: ${u}`,"",u,0,0)}},!0),i.addEventListener("unhandledrejection",r=>{const o=r==null?void 0:r.reason;let a,u;o instanceof Error?(a=o.message||"Unhandled promise rejection",u=o.stack||""):(a=o!=null?String(o):"Unhandled promise rejection",u=""),R(a,u)})),(l.trackOutbound||l.trackDownloads)&&c.addEventListener("click",Te,!0);const t=()=>{c.body&&Q(c.body)};c.readyState==="loading"?c.addEventListener("DOMContentLoaded",t):t(),typeof MutationObserver=="function"&&c.body&&new MutationObserver(o=>{var a;for(const u of o)if(u.addedNodes){for(const d of u.addedNodes)if(d.nodeType===Node.ELEMENT_NODE){if((a=d.hasAttribute)!=null&&a.call(d,"skopos-event"))Q(d.parentElement||c.body);else if(d.querySelector)try{d.querySelector("[skopos-event]")&&Q(d)}catch(m){}}}}).observe(c.body,{childList:!0,subtree:!0});for(const r of e)Array.isArray(r)&&ne(...r);f("Initialized with config:",l)}const Ae=((ie=i.skopos)==null?void 0:ie.q)||[];i.skopos=(...e)=>{i.skopos.q=i.skopos.q||[],i.skopos.q.push(e)},i.skopos.q=Ae,c.readyState==="loading"?c.addEventListener("DOMContentLoaded",se,{once:!0}):se()})(window,document,navigator,location,history);
