var Ae=Object.defineProperty,Ie=Object.defineProperties;var Oe=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var Ne=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable;var ae=(i,a,f)=>a in i?Ae(i,a,{enumerable:!0,configurable:!0,writable:!0,value:f}):i[a]=f,S=(i,a)=>{for(var f in a||(a={}))Ne.call(a,f)&&ae(i,f,a[f]);if(oe)for(var f of oe(a))xe.call(a,f)&&ae(i,f,a[f]);return i},E=(i,a)=>Ie(i,Oe(a));((i,a,f,g,x)=>{var se;const $=a.currentScript;if(!$)return;const y=e=>$.getAttribute(e),u={siteId:y("data-site-id")||"",host:(y("data-host")||"").replace(/\/+$/,""),autoTrack:y("data-auto-track")!=="false",trackErrors:y("data-track-errors")!=="false",trackOutbound:y("data-track-outbound")!=="false",trackDownloads:y("data-track-downloads")!=="false",hashMode:y("data-hash-mode")==="true",respectDnt:y("data-respect-dnt")==="true",debug:y("data-debug")==="true",batchInterval:Math.max(1e3,Number.parseInt(y("data-batch-interval"),10)||5e3),maxBatchSize:Math.min(50,Math.max(1,Number.parseInt(y("data-max-batch-size"),10)||10)),sessionTimeout:Math.max(6e4,Number.parseInt(y("data-session-timeout"),10)||18e5)};if(!u.siteId){console.warn("[Skopos] Missing required data-site-id attribute");return}if(!u.host){console.warn("[Skopos] Missing required data-host attribute");return}if(u.respectDnt&&(f.doNotTrack==="1"||i.doNotTrack==="1")){u.debug&&console.log("[Skopos] Do Not Track enabled, analytics disabled"),i.skopos=()=>{};return}const V=`${u.host}/collect`,v="_sk_",B=`${v}sid`,J=`${v}vid`,K=`${v}la`,L=`${v}q`,ce=100,ue=50,W=/\.(pdf|zip|rar|7z|tar|gz|dmg|exe|msi|doc|docx|xls|xlsx|ppt|pptx|csv|mp3|mp4|avi|mov|webm)(?:[?#]|$)/i,l=u.debug?(...e)=>console.log("[Skopos]",...e):()=>{},F=(...e)=>console.warn("[Skopos]",...e);function j(){try{const e=new Uint8Array(16);return(i.crypto||i.msCrypto).getRandomValues(e),Array.from(e,t=>t.toString(16).padStart(2,"0")).join("").slice(0,24)}catch(e){let t="";for(let r=0;r<24;r++)t+=Math.floor(Math.random()*16).toString(16);return t}}function M(e){try{return localStorage.getItem(e)}catch(t){return null}}function P(e,t){try{return localStorage.setItem(e,t),!0}catch(r){return!1}}function Y(e){try{return localStorage.removeItem(e),!0}catch(t){return!1}}function G(e){try{return sessionStorage.getItem(e)}catch(t){return null}}function X(e,t){try{return sessionStorage.setItem(e,t),!0}catch(r){return!1}}function le(){let e=M(J);return(!e||typeof e!="string"||e.length<16)&&(e=j(),P(J,e)),e}function H(){const e=Date.now();let t=G(B);const r=Number.parseInt(G(K),10)||0;return(!t||typeof t!="string"||t.length<16||r>0&&e-r>u.sessionTimeout)&&(t=j(),X(B,t)),X(K,String(e)),t}function d(e,t=2048){if(e==null)return"";let r=e;if(typeof r!="string")try{r=String(r)}catch(o){return""}let n="";for(let o=0;o<r.length;o++){const c=r.charCodeAt(o);(c>=32&&c<127||c>159)&&(n+=r[o])}return n.trim().slice(0,t)}function q(e,t=5,r=0){if(r>=t||e==null)return null;if(typeof e=="string")return d(e,1024);if(typeof e=="number")return Number.isFinite(e)?e:null;if(typeof e=="boolean")return e;if(Array.isArray(e))return e.slice(0,100).map(n=>q(n,t,r+1)).filter(n=>n!=null);if(typeof e=="object"){const n={},o=Object.keys(e).slice(0,50);for(const c of o){const h=d(c,128);if(h){const p=q(e[c],t,r+1);p!=null&&(n[h]=p)}}return n}return null}function R(e){if(typeof e!="string")return null;try{const t=JSON.parse(e);return t&&typeof t=="object"?t:null}catch(t){return null}}function fe(e){if(!e||typeof e!="string")return!1;try{return new URL(e,g.href).hostname.toLowerCase()!==g.hostname.toLowerCase()}catch(t){return!1}}function de(e){if(!e||typeof e!="string")return!1;try{const t=new URL(e,g.href).pathname;return W.test(t)}catch(t){return W.test(e)}}function he(){return u.hashMode?g.hash.slice(1)||"/":g.pathname+g.search}function pe(){return g.href}function ye(){const e=f.userAgent;return!!(!e||typeof e!="string"||/bot|crawl|spider|scrape|headless|phantom|selenium|puppeteer|playwright|prerender|lighthouse/i.test(e)||f.webdriver===!0||i._phantom||i.__nightmare||i.callPhantom)}const s={visitorId:le(),sessionId:H(),lastPath:null,pageEntryTime:Date.now(),totalActiveTime:0,lastActiveTime:Date.now(),isVisible:!a.hidden,hasTrackedExit:!1,eventQueue:[],errorQueue:new Map,flushTimer:null,errorFlushTimer:null,initialized:!1,identifiedUser:null,isFlushing:!1};function A(){var e,t;return{sid:u.siteId,vid:s.visitorId,ssid:s.sessionId,url:d(pe(),4096),ref:d(a.referrer,2048),sw:((e=i.screen)==null?void 0:e.width)||0,sh:((t=i.screen)==null?void 0:t.height)||0,vw:i.innerWidth||0,vh:i.innerHeight||0,lang:(f.language||"").slice(0,10),tz:(()=>{try{return Intl.DateTimeFormat().resolvedOptions().timeZone||""}catch(r){return""}})(),ts:Date.now()}}function T(e,t=!1){if(!e)return!1;let r;try{r=JSON.stringify(e)}catch(n){return l("Failed to serialize payload:",n),!1}if(l("Sending:",e),t&&f.sendBeacon)try{const n=new Blob([r],{type:"application/json"});if(f.sendBeacon(V,n))return!0}catch(n){l("sendBeacon failed:",n)}try{return fetch(V,{method:"POST",headers:{"Content-Type":"application/json"},body:r,keepalive:!0,mode:"cors",credentials:"omit"}).catch(n=>{l("Fetch failed:",n),Z(e)}),!0}catch(n){return l("Request failed:",n),Z(e),!1}}function Z(e){try{const t=R(M(L))||[];if(!Array.isArray(t))return;for(t.push(e);t.length>ue;)t.shift();P(L,JSON.stringify(t))}catch(t){l("Failed to store request:",t)}}function ge(){try{const e=R(M(L));if(!Array.isArray(e)||e.length===0)return;Y(L);for(const t of e)t&&typeof t=="object"&&T(t)}catch(e){l("Failed to retry requests:",e)}}function z(e){e&&(s.eventQueue.push(e),s.eventQueue.length>=u.maxBatchSize?U():s.flushTimer||(s.flushTimer=setTimeout(U,u.batchInterval)))}function U(e=!1){if(s.flushTimer&&(clearTimeout(s.flushTimer),s.flushTimer=null),s.eventQueue.length===0||s.isFlushing)return;s.isFlushing=!0;const t=s.eventQueue.slice();s.eventQueue.length=0,s.isFlushing=!1;const r=E(S({},A()),{type:"batch",events:t});T(r,e)}function w(){if(s.isVisible){const e=Date.now(),t=e-s.lastActiveTime;t>0&&t<u.sessionTimeout&&(s.totalActiveTime+=t),s.lastActiveTime=e}}function me(){w();const e=Math.round(s.totalActiveTime/1e3);return Math.max(0,Math.min(e,86400))}function _(){s.pageEntryTime=Date.now(),s.totalActiveTime=0,s.lastActiveTime=Date.now(),s.isVisible=!a.hidden,s.hasTrackedExit=!1}function k(e=!1){const t=he();if(t===s.lastPath)return;s.lastPath=t,s.sessionId=H();const r={t:"pv",p:d(t,2048)};if(e||!s.initialized){const n=E(S({},A()),{type:"batch",events:[r]});T(n)}else z(r);l("Page view:",t)}function ee(e,t={}){if(!e||typeof e!="string"){F("Event name must be a non-empty string");return}const r={t:"ev",n:d(e,255)};if(t&&typeof t=="object"&&!Array.isArray(t)){const n=q(t);if(n)try{JSON.stringify(n).length<=8192&&(r.d=n)}catch(o){F("Invalid event data")}}z(r),l("Event:",e,t)}function I(e="leave"){if(s.hasTrackedExit)return;s.hasTrackedExit=!0;const t=me();if(t<1)return;U(!0);const r=E(S({},A()),{type:"exit",dur:t,reason:d(e,32)});T(r,!0),l("Page exit:",e,`${t}s`)}function te(e,t,r,n,o){if(!u.trackErrors)return;const c=d(e||"Unknown error",512),h=d(t||"",4096),p=h.split(`
`)[1]||"",m=`${c}|${p}`,b=s.errorQueue.get(m);if(b){b.count=Math.min(b.count+1,1e4);return}s.errorQueue.size>=ce&&O(),s.errorQueue.set(m,{msg:c,stack:h,src:d(r||"",512),line:typeof n=="number"&&Number.isFinite(n)?n:0,col:typeof o=="number"&&Number.isFinite(o)?o:0,count:1}),s.errorFlushTimer||(s.errorFlushTimer=setTimeout(O,1e4)),l("Error tracked:",e)}function O(e=!1){if(s.errorFlushTimer&&(clearTimeout(s.errorFlushTimer),s.errorFlushTimer=null),s.errorQueue.size===0)return;const t=Array.from(s.errorQueue.values());s.errorQueue.clear();const r=E(S({},A()),{type:"errors",errors:t});T(r,e)}function ve(e){!u.trackOutbound||!e||(z({t:"out",u:d(e,2048)}),l("Outbound:",e))}function ke(e){var r;if(!u.trackDownloads||!e)return;let t="";try{t=new URL(e,g.href).pathname.split("/").pop()||""}catch(n){t=((r=e.split("/").pop())==null?void 0:r.split("?")[0])||""}z({t:"dl",f:d(t,255),u:d(e,2048)}),l("Download:",t)}function be(e,t={}){if(!e||typeof e!="string"){F("User ID must be a non-empty string");return}s.identifiedUser={id:d(e,255)};const r={uid:s.identifiedUser.id};if(t&&typeof t=="object"&&(t.name&&(r.name=d(t.name,255)),t.email&&(r.email=d(t.email,255)),t.phone&&(r.phone=d(t.phone,50)),t.metadata&&typeof t.metadata=="object")){const o=q(t.metadata);if(o)try{JSON.stringify(o).length<=4096&&(r.meta=o)}catch(c){l("Invalid metadata:",c)}}const n=S(E(S({},A()),{type:"identify"}),r);T(n),l("Identify:",e,t)}function Q(e){if(!e||!e.querySelectorAll)return;let t;try{t=e.querySelectorAll("[skopos-event]:not([skopos-bound])")}catch(r){return}for(const r of t){const n=r.getAttribute("skopos-event");if(!n)continue;const o=r.getAttribute("skopos-event-on")||"click";r.addEventListener(o,()=>{let c={};const h=r.getAttribute("skopos-data");if(h){const m=R(h);m&&!Array.isArray(m)&&(c=m)}const p=r.getAttribute("skopos-data-from");if(p){const m=p.split(",");for(const b of m){const D=b.indexOf(":");if(D===-1)continue;const ie=b.slice(0,D).trim(),C=b.slice(D+1).trim();if(ie&&C)try{const N=a.querySelector(C);if(N){const Ee="value"in N?N.value:N.textContent;c[ie]=(Ee||"").trim()}}catch(N){l("Invalid selector:",C)}}}ee(n,c)}),r.setAttribute("skopos-bound","true")}}function Se(e){if(!e||!e.target)return;const t=e.target.closest?e.target.closest("a[href]"):null;if(!t)return;const r=t.getAttribute("href");if(!r||r.startsWith("#")||r.startsWith("javascript:")||r.startsWith("mailto:")||r.startsWith("tel:"))return;let n;try{n=new URL(r,g.href).href}catch(o){return}de(n)?ke(n):fe(n)&&ve(n)}function re(e,...t){if(typeof e=="string")switch(e){case"event":ee(t[0],t[1]);break;case"pageview":k();break;case"identify":be(t[0],t[1]);break;case"opt-out":P(`${v}optout`,"1"),i.skopos=()=>{};break;case"opt-in":Y(`${v}optout`);try{g.reload()}catch(r){}break;case"debug":u.debug=t[0]!==!1;break;default:F("Unknown command:",e)}}function ne(){var r;if(s.initialized)return;if(M(`${v}optout`)==="1"){l("User opted out"),i.skopos=()=>{};return}if(ye()){l("Bot detected, skipping"),i.skopos=()=>{};return}s.initialized=!0;const e=((r=i.skopos)==null?void 0:r.q)||[];if(i.skopos=re,ge(),u.autoTrack){a.readyState==="complete"?k(!0):i.addEventListener("load",()=>k(!0),{once:!0});const n=x.pushState;x.pushState=function(...c){I("navigate");const h=n.apply(this,c);return _(),setTimeout(k,0),h};const o=x.replaceState;x.replaceState=function(...c){const h=o.apply(this,c);return setTimeout(k,0),h},i.addEventListener("popstate",()=>{I("navigate"),_(),k()}),u.hashMode&&i.addEventListener("hashchange",()=>{I("navigate"),_(),k()})}a.addEventListener("visibilitychange",()=>{a.hidden?(w(),s.isVisible=!1,U(!0),O(!0)):(s.isVisible=!0,s.lastActiveTime=Date.now())}),i.addEventListener("pagehide",()=>{I("leave"),O(!0)}),i.addEventListener("beforeunload",()=>{I("leave"),O(!0)}),u.trackErrors&&(i.addEventListener("error",n=>{var o;n!=null&&n.message&&te(n.message,(o=n.error)==null?void 0:o.stack,n.filename,n.lineno,n.colno)}),i.addEventListener("unhandledrejection",n=>{const o=n==null?void 0:n.reason,c=(o==null?void 0:o.message)||(o!=null?String(o):"Unhandled promise rejection"),h=(o==null?void 0:o.stack)||"";te(c,h)})),(u.trackOutbound||u.trackDownloads)&&a.addEventListener("click",Se,!0);const t=()=>{a.body&&Q(a.body)};a.readyState==="loading"?a.addEventListener("DOMContentLoaded",t):t(),typeof MutationObserver=="function"&&a.body&&new MutationObserver(o=>{var c;for(const h of o)if(h.addedNodes){for(const p of h.addedNodes)if(p.nodeType===Node.ELEMENT_NODE){if((c=p.hasAttribute)!=null&&c.call(p,"skopos-event"))Q(p.parentElement||a.body);else if(p.querySelector)try{p.querySelector("[skopos-event]")&&Q(p)}catch(m){}}}}).observe(a.body,{childList:!0,subtree:!0});for(const n of e)Array.isArray(n)&&re(...n);l("Initialized with config:",u)}const Te=((se=i.skopos)==null?void 0:se.q)||[];i.skopos=(...e)=>{i.skopos.q=i.skopos.q||[],i.skopos.q.push(e)},i.skopos.q=Te,a.readyState==="loading"?a.addEventListener("DOMContentLoaded",ne,{once:!0}):ne()})(window,document,navigator,location,history);
