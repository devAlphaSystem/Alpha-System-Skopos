var Oe=Object.defineProperty,Ne=Object.defineProperties;var Le=Object.getOwnPropertyDescriptors;var ae=Object.getOwnPropertySymbols;var xe=Object.prototype.hasOwnProperty,Fe=Object.prototype.propertyIsEnumerable;var ce=(o,a,f)=>a in o?Oe(o,a,{enumerable:!0,configurable:!0,writable:!0,value:f}):o[a]=f,S=(o,a)=>{for(var f in a||(a={}))xe.call(a,f)&&ce(o,f,a[f]);if(ae)for(var f of ae(a))Fe.call(a,f)&&ce(o,f,a[f]);return o},T=(o,a)=>Ne(o,Le(a));((o,a,f,g,L)=>{var ie;const $=a.currentScript;if(!$)return;const y=e=>$.getAttribute(e),u={siteId:y("data-site-id")||"",host:(y("data-host")||"").replace(/\/+$/,""),autoTrack:y("data-auto-track")!=="false",trackErrors:y("data-track-errors")!=="false",trackOutbound:y("data-track-outbound")!=="false",trackDownloads:y("data-track-downloads")!=="false",hashMode:y("data-hash-mode")==="true",respectDnt:y("data-respect-dnt")==="true",debug:y("data-debug")==="true",batchInterval:Math.max(1e3,Number.parseInt(y("data-batch-interval"),10)||5e3),maxBatchSize:Math.min(50,Math.max(1,Number.parseInt(y("data-max-batch-size"),10)||10)),sessionTimeout:Math.max(6e4,Number.parseInt(y("data-session-timeout"),10)||18e5)};if(!u.siteId){console.warn("[Skopos] Missing required data-site-id attribute");return}if(!u.host){console.warn("[Skopos] Missing required data-host attribute");return}if(u.respectDnt&&(f.doNotTrack==="1"||o.doNotTrack==="1")){u.debug&&console.log("[Skopos] Do Not Track enabled, analytics disabled"),o.skopos=()=>{};return}const B=`${u.host}/collect`,v="_sk_",V=`${v}sid`,J=`${v}vid`,K=`${v}la`,x=`${v}q`,ue=100,le=50,j=/\.(pdf|zip|rar|7z|tar|gz|dmg|exe|msi|doc|docx|xls|xlsx|ppt|pptx|csv|mp3|mp4|avi|mov|webm)(?:[?#]|$)/i,W="sk0p0s_4n4lyt1cs_0bf_k3y_2026";function fe(e){try{const t=JSON.stringify(e),r=W.length;let n="";for(let i=0;i<t.length;i++){const c=t.charCodeAt(i)^W.charCodeAt(i%r);n+=String.fromCharCode(c)}return btoa(unescape(encodeURIComponent(n)))}catch(t){return null}}const l=u.debug?(...e)=>console.log("[Skopos]",...e):()=>{},F=(...e)=>console.warn("[Skopos]",...e);function Y(){try{const e=new Uint8Array(16);return(o.crypto||o.msCrypto).getRandomValues(e),Array.from(e,t=>t.toString(16).padStart(2,"0")).join("").slice(0,24)}catch(e){let t="";for(let r=0;r<24;r++)t+=Math.floor(Math.random()*16).toString(16);return t}}function _(e){try{return localStorage.getItem(e)}catch(t){return null}}function z(e,t){try{return localStorage.setItem(e,t),!0}catch(r){return!1}}function G(e){try{return localStorage.removeItem(e),!0}catch(t){return!1}}function X(e){try{return sessionStorage.getItem(e)}catch(t){return null}}function H(e,t){try{return sessionStorage.setItem(e,t),!0}catch(r){return!1}}function de(){let e=_(J);return(!e||typeof e!="string"||e.length<16)&&(e=Y(),z(J,e)),e}function Z(){const e=Date.now();let t=X(V);const r=Number.parseInt(X(K),10)||0;return(!t||typeof t!="string"||t.length<16||r>0&&e-r>u.sessionTimeout)&&(t=Y(),H(V,t)),H(K,String(e)),t}function d(e,t=2048){if(e==null)return"";let r=e;if(typeof r!="string")try{r=String(r)}catch(i){return""}let n="";for(let i=0;i<r.length;i++){const c=r.charCodeAt(i);(c>=32&&c<127||c>159)&&(n+=r[i])}return n.trim().slice(0,t)}function M(e,t=5,r=0){if(r>=t||e==null)return null;if(typeof e=="string")return d(e,1024);if(typeof e=="number")return Number.isFinite(e)?e:null;if(typeof e=="boolean")return e;if(Array.isArray(e))return e.slice(0,100).map(n=>M(n,t,r+1)).filter(n=>n!=null);if(typeof e=="object"){const n={},i=Object.keys(e).slice(0,50);for(const c of i){const h=d(c,128);if(h){const p=M(e[c],t,r+1);p!=null&&(n[h]=p)}}return n}return null}function C(e){if(typeof e!="string")return null;try{const t=JSON.parse(e);return t&&typeof t=="object"?t:null}catch(t){return null}}function he(e){if(!e||typeof e!="string")return!1;try{return new URL(e,g.href).hostname.toLowerCase()!==g.hostname.toLowerCase()}catch(t){return!1}}function pe(e){if(!e||typeof e!="string")return!1;try{const t=new URL(e,g.href).pathname;return j.test(t)}catch(t){return j.test(e)}}function ye(){return u.hashMode?g.hash.slice(1)||"/":g.pathname+g.search}function ge(){return g.href}function me(){const e=f.userAgent;return!!(!e||typeof e!="string"||/bot|crawl|spider|scrape|headless|phantom|selenium|puppeteer|playwright|prerender|lighthouse/i.test(e)||f.webdriver===!0||o._phantom||o.__nightmare||o.callPhantom)}const s={visitorId:de(),sessionId:Z(),lastPath:null,pageEntryTime:Date.now(),totalActiveTime:0,lastActiveTime:Date.now(),isVisible:!a.hidden,hasTrackedExit:!1,eventQueue:[],errorQueue:new Map,flushTimer:null,errorFlushTimer:null,initialized:!1,identifiedUser:null,isFlushing:!1};function A(){var e,t;return{sid:u.siteId,vid:s.visitorId,ssid:s.sessionId,url:d(ge(),4096),ref:d(a.referrer,2048),sw:((e=o.screen)==null?void 0:e.width)||0,sh:((t=o.screen)==null?void 0:t.height)||0,vw:o.innerWidth||0,vh:o.innerHeight||0,lang:(f.language||"").slice(0,10),tz:(()=>{try{return Intl.DateTimeFormat().resolvedOptions().timeZone||""}catch(r){return""}})(),ts:Date.now()}}function E(e,t=!1){if(!e)return!1;let r;try{const n=fe(e);if(!n)return l("Failed to obfuscate payload"),!1;r=JSON.stringify({_d:n,_v:1})}catch(n){return l("Failed to serialize payload:",n),!1}if(l("Sending:",e),t&&f.sendBeacon)try{const n=new Blob([r],{type:"application/json"});if(f.sendBeacon(B,n))return!0}catch(n){l("sendBeacon failed:",n)}try{return fetch(B,{method:"POST",headers:{"Content-Type":"application/json"},body:r,keepalive:!0,mode:"cors",credentials:"omit"}).catch(n=>{l("Fetch failed:",n),w(e)}),!0}catch(n){return l("Request failed:",n),w(e),!1}}function w(e){try{const t=C(_(x))||[];if(!Array.isArray(t))return;for(t.push(e);t.length>le;)t.shift();z(x,JSON.stringify(t))}catch(t){l("Failed to store request:",t)}}function ve(){try{const e=C(_(x));if(!Array.isArray(e)||e.length===0)return;G(x);for(const t of e)t&&typeof t=="object"&&E(t)}catch(e){l("Failed to retry requests:",e)}}function U(e){e&&(s.eventQueue.push(e),s.eventQueue.length>=u.maxBatchSize?q():s.flushTimer||(s.flushTimer=setTimeout(q,u.batchInterval)))}function q(e=!1){if(s.flushTimer&&(clearTimeout(s.flushTimer),s.flushTimer=null),s.eventQueue.length===0||s.isFlushing)return;s.isFlushing=!0;const t=s.eventQueue.slice();s.eventQueue.length=0,s.isFlushing=!1;const r=T(S({},A()),{type:"batch",events:t});E(r,e)}function ee(){if(s.isVisible){const e=Date.now(),t=e-s.lastActiveTime;t>0&&t<u.sessionTimeout&&(s.totalActiveTime+=t),s.lastActiveTime=e}}function ke(){ee();const e=Math.round(s.totalActiveTime/1e3);return Math.max(0,Math.min(e,86400))}function P(){s.pageEntryTime=Date.now(),s.totalActiveTime=0,s.lastActiveTime=Date.now(),s.isVisible=!a.hidden,s.hasTrackedExit=!1}function k(e=!1){const t=ye();if(t===s.lastPath)return;s.lastPath=t,s.sessionId=Z();const r={t:"pv",p:d(t,2048)};if(e||!s.initialized){const n=T(S({},A()),{type:"batch",events:[r]});E(n)}else U(r);l("Page view:",t)}function te(e,t={}){if(!e||typeof e!="string"){F("Event name must be a non-empty string");return}const r={t:"ev",n:d(e,255)};if(t&&typeof t=="object"&&!Array.isArray(t)){const n=M(t);if(n)try{JSON.stringify(n).length<=8192&&(r.d=n)}catch(i){F("Invalid event data")}}U(r),l("Event:",e,t)}function I(e="leave"){if(s.hasTrackedExit)return;s.hasTrackedExit=!0;const t=ke();if(t<1)return;q(!0);const r=T(S({},A()),{type:"exit",dur:t,reason:d(e,32)});E(r,!0),l("Page exit:",e,`${t}s`)}function re(e,t,r,n,i){if(!u.trackErrors)return;const c=d(e||"Unknown error",512),h=d(t||"",4096),p=h.split(`
`)[1]||"",m=`${c}|${p}`,b=s.errorQueue.get(m);if(b){b.count=Math.min(b.count+1,1e4);return}s.errorQueue.size>=ue&&O(),s.errorQueue.set(m,{msg:c,stack:h,src:d(r||"",512),line:typeof n=="number"&&Number.isFinite(n)?n:0,col:typeof i=="number"&&Number.isFinite(i)?i:0,count:1}),s.errorFlushTimer||(s.errorFlushTimer=setTimeout(O,1e4)),l("Error tracked:",e)}function O(e=!1){if(s.errorFlushTimer&&(clearTimeout(s.errorFlushTimer),s.errorFlushTimer=null),s.errorQueue.size===0)return;const t=Array.from(s.errorQueue.values());s.errorQueue.clear();const r=T(S({},A()),{type:"errors",errors:t});E(r,e)}function be(e){!u.trackOutbound||!e||(U({t:"out",u:d(e,2048)}),l("Outbound:",e))}function Se(e){var r;if(!u.trackDownloads||!e)return;let t="";try{t=new URL(e,g.href).pathname.split("/").pop()||""}catch(n){t=((r=e.split("/").pop())==null?void 0:r.split("?")[0])||""}U({t:"dl",f:d(t,255),u:d(e,2048)}),l("Download:",t)}function Ee(e,t={}){if(!e||typeof e!="string"){F("User ID must be a non-empty string");return}s.identifiedUser={id:d(e,255)};const r={uid:s.identifiedUser.id};if(t&&typeof t=="object"&&(t.name&&(r.name=d(t.name,255)),t.email&&(r.email=d(t.email,255)),t.phone&&(r.phone=d(t.phone,50)),t.metadata&&typeof t.metadata=="object")){const i=M(t.metadata);if(i)try{JSON.stringify(i).length<=4096&&(r.meta=i)}catch(c){l("Invalid metadata:",c)}}const n=S(T(S({},A()),{type:"identify"}),r);E(n),l("Identify:",e,t)}function R(e){if(!e||!e.querySelectorAll)return;let t;try{t=e.querySelectorAll("[skopos-event]:not([skopos-bound])")}catch(r){return}for(const r of t){const n=r.getAttribute("skopos-event");if(!n)continue;const i=r.getAttribute("skopos-event-on")||"click";r.addEventListener(i,()=>{let c={};const h=r.getAttribute("skopos-data");if(h){const m=C(h);m&&!Array.isArray(m)&&(c=m)}const p=r.getAttribute("skopos-data-from");if(p){const m=p.split(",");for(const b of m){const Q=b.indexOf(":");if(Q===-1)continue;const oe=b.slice(0,Q).trim(),D=b.slice(Q+1).trim();if(oe&&D)try{const N=a.querySelector(D);if(N){const Ie="value"in N?N.value:N.textContent;c[oe]=(Ie||"").trim()}}catch(N){l("Invalid selector:",D)}}}te(n,c)}),r.setAttribute("skopos-bound","true")}}function Te(e){if(!e||!e.target)return;const t=e.target.closest?e.target.closest("a[href]"):null;if(!t)return;const r=t.getAttribute("href");if(!r||r.startsWith("#")||r.startsWith("javascript:")||r.startsWith("mailto:")||r.startsWith("tel:"))return;let n;try{n=new URL(r,g.href).href}catch(i){return}pe(n)?Se(n):he(n)&&be(n)}function ne(e,...t){if(typeof e=="string")switch(e){case"event":te(t[0],t[1]);break;case"pageview":k();break;case"identify":Ee(t[0],t[1]);break;case"opt-out":z(`${v}optout`,"1"),o.skopos=()=>{};break;case"opt-in":G(`${v}optout`);try{g.reload()}catch(r){}break;case"debug":u.debug=t[0]!==!1;break;default:F("Unknown command:",e)}}function se(){var r;if(s.initialized)return;if(_(`${v}optout`)==="1"){l("User opted out"),o.skopos=()=>{};return}if(me()){l("Bot detected, skipping"),o.skopos=()=>{};return}s.initialized=!0;const e=((r=o.skopos)==null?void 0:r.q)||[];if(o.skopos=ne,ve(),u.autoTrack){a.readyState==="complete"?k(!0):o.addEventListener("load",()=>k(!0),{once:!0});const n=L.pushState;L.pushState=function(...c){I("navigate");const h=n.apply(this,c);return P(),setTimeout(k,0),h};const i=L.replaceState;L.replaceState=function(...c){const h=i.apply(this,c);return setTimeout(k,0),h},o.addEventListener("popstate",()=>{I("navigate"),P(),k()}),u.hashMode&&o.addEventListener("hashchange",()=>{I("navigate"),P(),k()})}a.addEventListener("visibilitychange",()=>{a.hidden?(ee(),s.isVisible=!1,q(!0),O(!0)):(s.isVisible=!0,s.lastActiveTime=Date.now())}),o.addEventListener("pagehide",()=>{I("leave"),O(!0)}),o.addEventListener("beforeunload",()=>{I("leave"),O(!0)}),u.trackErrors&&(o.addEventListener("error",n=>{var i;n!=null&&n.message&&re(n.message,(i=n.error)==null?void 0:i.stack,n.filename,n.lineno,n.colno)}),o.addEventListener("unhandledrejection",n=>{const i=n==null?void 0:n.reason,c=(i==null?void 0:i.message)||(i!=null?String(i):"Unhandled promise rejection"),h=(i==null?void 0:i.stack)||"";re(c,h)})),(u.trackOutbound||u.trackDownloads)&&a.addEventListener("click",Te,!0);const t=()=>{a.body&&R(a.body)};a.readyState==="loading"?a.addEventListener("DOMContentLoaded",t):t(),typeof MutationObserver=="function"&&a.body&&new MutationObserver(i=>{var c;for(const h of i)if(h.addedNodes){for(const p of h.addedNodes)if(p.nodeType===Node.ELEMENT_NODE){if((c=p.hasAttribute)!=null&&c.call(p,"skopos-event"))R(p.parentElement||a.body);else if(p.querySelector)try{p.querySelector("[skopos-event]")&&R(p)}catch(m){}}}}).observe(a.body,{childList:!0,subtree:!0});for(const n of e)Array.isArray(n)&&ne(...n);l("Initialized with config:",u)}const Ae=((ie=o.skopos)==null?void 0:ie.q)||[];o.skopos=(...e)=>{o.skopos.q=o.skopos.q||[],o.skopos.q.push(e)},o.skopos.q=Ae,a.readyState==="loading"?a.addEventListener("DOMContentLoaded",se,{once:!0}):se()})(window,document,navigator,location,history);
