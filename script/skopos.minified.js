var Fe=Object.defineProperty,Pe=Object.defineProperties;var ze=Object.getOwnPropertyDescriptors;var le=Object.getOwnPropertySymbols;var $e=Object.prototype.hasOwnProperty,qe=Object.prototype.propertyIsEnumerable;var fe=(a,c,h)=>c in a?Fe(a,c,{enumerable:!0,configurable:!0,writable:!0,value:h}):a[c]=h,E=(a,c)=>{for(var h in c||(c={}))$e.call(c,h)&&fe(a,h,c[h]);if(le)for(var h of le(c))qe.call(c,h)&&fe(a,h,c[h]);return a},N=(a,c)=>Pe(a,ze(c));((a,c,h,b,M)=>{var ce;const V=c.currentScript;if(!V)return;const y=e=>V.getAttribute(e),f={siteId:y("data-site-id")||"",host:(y("data-host")||"").replace(/\/+$/,""),autoTrack:y("data-auto-track")!=="false",trackErrors:y("data-track-errors")!=="false",trackOutbound:y("data-track-outbound")!=="false",trackDownloads:y("data-track-downloads")!=="false",hashMode:y("data-hash-mode")==="true",respectDnt:y("data-respect-dnt")==="true",debug:y("data-debug")==="true",batchInterval:Math.max(1e3,Number.parseInt(y("data-batch-interval"),10)||5e3),maxBatchSize:Math.min(50,Math.max(1,Number.parseInt(y("data-max-batch-size"),10)||10)),sessionTimeout:Math.max(6e4,Number.parseInt(y("data-session-timeout"),10)||18e5)};if(!f.siteId){console.warn("[Skopos] Missing required data-site-id attribute");return}if(!f.host){console.warn("[Skopos] Missing required data-host attribute");return}if(f.respectDnt&&(h.doNotTrack==="1"||a.doNotTrack==="1")){f.debug&&console.log("[Skopos] Do Not Track enabled, analytics disabled"),a.skopos=()=>{};return}const K=`${f.host}/collect`,v="_sk_",J=`${v}sid`,W=`${v}vid`,G=`${v}la`,R=`${v}q`,de=100,he=50,Y=/\.(pdf|zip|rar|7z|tar|gz|dmg|exe|msi|doc|docx|xls|xlsx|ppt|pptx|csv|mp3|mp4|avi|mov|webm)(?:[?#]|$)/i,w="sk0p0s_4n4lyt1cs_0bf_k3y_2026",pe="1.3.0",ge=10,T={NAVIGATION:"navigation",CLICK:"click",INPUT:"input",CUSTOM:"custom",CONSOLE:"console",NETWORK:"network"};function me(e){try{const t=JSON.stringify(e),n=w.length;let r="";for(let i=0;i<t.length;i++){const o=t.charCodeAt(i)^w.charCodeAt(i%n);r+=String.fromCharCode(o)}return btoa(encodeURIComponent(r).replace(/%([0-9A-F]{2})/g,(i,o)=>String.fromCharCode(Number.parseInt(o,16))))}catch(t){return null}}const d=(...e)=>{f.debug&&console.log("[Skopos]",...e)},O=(...e)=>console.warn("[Skopos]",...e);function X(){try{const e=new Uint8Array(16);return(a.crypto||a.msCrypto).getRandomValues(e),Array.from(e,t=>t.toString(16).padStart(2,"0")).join("").slice(0,24)}catch(e){let t="";for(let n=0;n<24;n++)t+=Math.floor(Math.random()*16).toString(16);return t}}function F(e){try{return localStorage.getItem(e)}catch(t){return null}}function $(e,t){try{return localStorage.setItem(e,t),!0}catch(n){return!1}}function H(e){try{return localStorage.removeItem(e),!0}catch(t){return!1}}function Z(e){try{return sessionStorage.getItem(e)}catch(t){return null}}function ee(e,t){try{return sessionStorage.setItem(e,t),!0}catch(n){return!1}}function ye(){let e=F(W);return(!e||typeof e!="string"||e.length<16)&&(e=X(),$(W,e)),e}function te(){const e=Date.now();let t=Z(J);const n=Number.parseInt(Z(G),10)||0;return(!t||typeof t!="string"||t.length<16||n>0&&e-n>f.sessionTimeout)&&(t=X(),ee(J,t)),ee(G,String(e)),t}function p(e,t=2048){if(e==null)return"";let n=e;if(typeof n!="string")try{n=String(n)}catch(i){return""}let r="";for(let i=0;i<n.length&&r.length<t;i++){const o=n.charCodeAt(i);(o===9||o===10||o===13||o>=32&&o<=126||o>=160)&&(r+=n[i])}return r.trim()}function C(e,t=5,n=0){if(n>=t||e==null)return null;if(typeof e=="string")return p(e,1024);if(typeof e=="number")return Number.isFinite(e)?e:null;if(typeof e=="boolean")return e;if(Array.isArray(e))return e.slice(0,100).map(r=>C(r,t,n+1)).filter(r=>r!=null);if(typeof e=="object"){const r={},i=Object.keys(e).slice(0,50);for(const o of i){const u=p(o,128);if(u){const l=C(e[o],t,n+1);l!=null&&(r[u]=l)}}return r}return null}function q(e){if(typeof e!="string")return null;try{const t=JSON.parse(e);return t&&typeof t=="object"?t:null}catch(t){return null}}function be(e){if(!e||typeof e!="string")return!1;try{return new URL(e,b.href).hostname.toLowerCase()!==b.hostname.toLowerCase()}catch(t){return!1}}function ke(e){if(!e||typeof e!="string")return!1;try{const t=new URL(e,b.href).pathname;return Y.test(t)}catch(t){return Y.test(e)}}function ve(){return f.hashMode?b.hash.slice(1)||"/":b.pathname+b.search}function Se(){return b.href}function Ee(){const e=h.userAgent;return!!(!e||typeof e!="string"||/bot|crawl|spider|scrape|headless|phantom|selenium|puppeteer|playwright|prerender|lighthouse/i.test(e)||h.webdriver===!0||a._phantom||a.__nightmare||a.callPhantom)}const s={visitorId:ye(),sessionId:te(),lastPath:null,pageEntryTime:Date.now(),totalActiveTime:0,lastActiveTime:Date.now(),isVisible:!c.hidden,hasTrackedExit:!1,eventQueue:[],errorQueue:new Map,flushTimer:null,errorFlushTimer:null,initialized:!1,identifiedUser:null,isFlushing:!1,breadcrumbs:[]};function A(e,t,n={}){const r={t:e,m:p(t,256),ts:Date.now()};if(n&&typeof n=="object"&&Object.keys(n).length>0){const i=C(n,3);i&&Object.keys(i).length>0&&(r.d=i)}for(s.breadcrumbs.push(r);s.breadcrumbs.length>ge;)s.breadcrumbs.shift();d("Breadcrumb:",e,t)}function Te(){return s.breadcrumbs.slice()}function re(e){var o,u;if(!e||e===c.body||e===c.documentElement)return"body";const t=[];let n=e,r=0;const i=5;for(;n&&n!==c.body&&r<i;){let l=((o=n.tagName)==null?void 0:o.toLowerCase())||"";if(n.id){const m=n.id.replace(/[^a-zA-Z0-9_-]/g,"");if(m){l+=`#${m}`,t.unshift(l);break}}const g=typeof n.className=="string"?n.className:((u=n.className)==null?void 0:u.baseVal)||"";if(g){const m=g.trim().split(/\s+/).filter(k=>k&&!/^(ng-|_|js-)/.test(k)).slice(0,2);m.length>0&&(l+=`.${m.join(".")}`)}t.unshift(l),n=n.parentElement,r++}return t.join(" > ").slice(0,128)||"unknown"}function Ae(e){if(!e)return"";const t=e.getAttribute("aria-label")||e.getAttribute("title")||e.getAttribute("placeholder")||e.value||e.textContent||"";return p(t,50).replace(/\s+/g," ").trim()}function L(){var e,t;return{sid:f.siteId,vid:s.visitorId,ssid:s.sessionId,url:p(Se(),4096),ref:p(c.referrer,2048),sw:((e=a.screen)==null?void 0:e.width)||0,sh:((t=a.screen)==null?void 0:t.height)||0,vw:a.innerWidth||0,vh:a.innerHeight||0,dpr:a.devicePixelRatio||1,cn:(()=>{try{const n=h.connection||h.mozConnection||h.webkitConnection;return(n==null?void 0:n.effectiveType)||""}catch(n){return""}})(),lang:(h.language||"").slice(0,10),tz:(()=>{try{return Intl.DateTimeFormat().resolvedOptions().timeZone||""}catch(n){return""}})(),ts:Date.now(),sv:pe}}function I(e,t=!1){if(!e)return!1;let n;try{const r=me(e);if(!r)return d("Failed to obfuscate payload"),!1;n=JSON.stringify({_d:r,_v:1})}catch(r){return d("Failed to serialize payload:",r),!1}if(d("Sending:",e),t&&h.sendBeacon)try{const r=new Blob([n],{type:"application/json"});if(h.sendBeacon(K,r))return!0}catch(r){d("sendBeacon failed:",r)}try{return fetch(K,{method:"POST",headers:{"Content-Type":"application/json"},body:n,keepalive:!0,mode:"cors",credentials:"omit"}).catch(r=>{d("Fetch failed:",r),ne(e)}),!0}catch(r){return d("Request failed:",r),ne(e),!1}}function ne(e){try{const t=q(F(R))||[];if(!Array.isArray(t))return;for(t.push(e);t.length>he;)t.shift();$(R,JSON.stringify(t))}catch(t){d("Failed to store request:",t)}}function Ie(){try{const e=q(F(R));if(!Array.isArray(e)||e.length===0)return;H(R);for(const t of e)t&&typeof t=="object"&&I(t)}catch(e){d("Failed to retry requests:",e)}}function P(e){e&&(s.eventQueue.push(e),s.eventQueue.length>=f.maxBatchSize?z():s.flushTimer||(s.flushTimer=setTimeout(z,f.batchInterval)))}function z(e=!1){if(s.flushTimer&&(clearTimeout(s.flushTimer),s.flushTimer=null),s.eventQueue.length===0||s.isFlushing)return;s.isFlushing=!0;const t=s.eventQueue.slice();s.eventQueue.length=0,s.isFlushing=!1;const n=N(E({},L()),{type:"batch",events:t});I(n,e)}function se(){if(s.isVisible){const e=Date.now(),t=e-s.lastActiveTime;t>0&&t<f.sessionTimeout&&(s.totalActiveTime+=t),s.lastActiveTime=e}}function Ne(){se();const e=Math.round(s.totalActiveTime/1e3);return Math.max(0,Math.min(e,86400))}function D(){s.pageEntryTime=Date.now(),s.totalActiveTime=0,s.lastActiveTime=Date.now(),s.isVisible=!c.hidden,s.hasTrackedExit=!1}function S(e=!1){const t=ve();if(t===s.lastPath)return;const n=s.lastPath;s.lastPath=t,s.sessionId=te(),A(T.NAVIGATION,`Navigated to ${t}`,{from:n||"(initial)",to:t});const r={t:"pv",p:p(t,2048)};if(e||!s.initialized){const i=N(E({},L()),{type:"batch",events:[r]});I(i)}else P(r);d("Page view:",t)}function ie(e,t={}){if(!e||typeof e!="string"){O("Event name must be a non-empty string");return}A(T.CUSTOM,`Event: ${e}`,t);const n={t:"ev",n:p(e,255)};if(t&&typeof t=="object"&&!Array.isArray(t)){const r=C(t);if(r)try{JSON.stringify(r).length<=8192&&(n.d=r)}catch(i){O("Invalid event data")}}P(n),d("Event:",e,t)}function U(e="leave"){if(s.hasTrackedExit)return;s.hasTrackedExit=!0;const t=Ne();if(t<1)return;z(!0);const n=N(E({},L()),{type:"exit",dur:t,reason:p(e,32)});I(n,!0),d("Page exit:",e,`${t}s`)}function B(e,t,n,r,i){if(!f.trackErrors)return;const o=p(e||"Unknown error",512),u=p(t||"",4096),l=u.split(`
`)[1]||"",g=`${o}|${l}`,m=s.errorQueue.get(g);if(m){m.count=Math.min(m.count+1,1e4);return}s.errorQueue.size>=de&&x();const k=Te();s.errorQueue.set(g,{msg:o,stack:u,src:p(n||"",512),line:typeof r=="number"&&Number.isFinite(r)?r:0,col:typeof i=="number"&&Number.isFinite(i)?i:0,count:1,bc:k}),s.errorFlushTimer||(s.errorFlushTimer=setTimeout(x,1e4)),d("Error tracked:",e,"with",k.length,"breadcrumbs")}function x(e=!1){if(s.errorFlushTimer&&(clearTimeout(s.errorFlushTimer),s.errorFlushTimer=null),s.errorQueue.size===0)return;const t=Array.from(s.errorQueue.values());s.errorQueue.clear();const n=N(E({},L()),{type:"errors",errors:t});I(n,e)}function Oe(e){!f.trackOutbound||!e||(P({t:"out",u:p(e,2048)}),d("Outbound:",e))}function Ce(e){var n;if(!f.trackDownloads||!e)return;let t="";try{t=new URL(e,b.href).pathname.split("/").pop()||""}catch(r){t=((n=e.split("/").pop())==null?void 0:n.split("?")[0])||""}P({t:"dl",f:p(t,255),u:p(e,2048)}),d("Download:",t)}function Le(e,t={}){if(e==null||typeof e!="string"&&typeof e!="number"){O("User ID must be a non-empty string or number");return}const n=String(e);if(!n){O("User ID cannot be empty");return}s.identifiedUser={id:p(n,255)};const r={uid:s.identifiedUser.id};if(t&&typeof t=="object"&&(t.name&&(r.name=p(t.name,255)),t.email&&(r.email=p(t.email,255)),t.phone&&(r.phone=p(t.phone,50)),t.metadata&&typeof t.metadata=="object")){const o=C(t.metadata);if(o)try{JSON.stringify(o).length<=4096&&(r.meta=o)}catch(u){d("Invalid metadata:",u)}}const i=E(N(E({},L()),{type:"identify"}),r);I(i),d("Identify:",e,t)}function j(e){if(!e||!e.querySelectorAll)return;let t;try{t=e.querySelectorAll("[skopos-event]:not([skopos-bound])")}catch(n){return}for(const n of t){const r=n.getAttribute("skopos-event");if(!r)continue;const i=n.getAttribute("skopos-event-on")||"click";n.addEventListener(i,()=>{let o={};const u=n.getAttribute("skopos-data");if(u){const g=q(u);g&&!Array.isArray(g)&&(o=g)}const l=n.getAttribute("skopos-data-from");if(l){const g=l.split(",");for(const m of g){const k=m.indexOf(":");if(k===-1)continue;const ue=m.slice(0,k).trim(),Q=m.slice(k+1).trim();if(ue&&Q)try{const _=c.querySelector(Q);if(_){const Re="value"in _?_.value:_.textContent;o[ue]=(Re||"").trim()}}catch(_){d("Invalid selector:",Q)}}}ie(r,o)}),n.setAttribute("skopos-bound","true")}}function Ue(e){if(!e||!e.target)return;const t=e.target.closest?e.target.closest("a[href]"):null;if(!t)return;const n=t.getAttribute("href");if(!n||n.startsWith("#")||n.startsWith("javascript:")||n.startsWith("mailto:")||n.startsWith("tel:"))return;let r;try{r=new URL(n,b.href).href}catch(i){return}ke(r)?Ce(r):be(r)&&Oe(r)}function xe(e){var i;if(!e||!e.target)return;const t=e.target.closest?e.target.closest("button, a, input[type=submit], input[type=button], [role=button], [onclick]"):e.target;if(!t)return;const n=re(t),r=Ae(t);A(T.CLICK,r?`Clicked "${r}"`:`Clicked ${n}`,{selector:n,tag:(i=t.tagName)==null?void 0:i.toLowerCase()})}function _e(e){if(!e||!e.target)return;const t=e.target;if(!t.tagName||!["INPUT","TEXTAREA","SELECT"].includes(t.tagName))return;const n=t.type||"text";if(n==="password")return;const r=re(t),i=t.name||t.id||t.placeholder||n;A(T.INPUT,`Input on ${i}`,{selector:r,type:n})}function oe(e,...t){if(typeof e=="string")switch(e){case"event":ie(t[0],t[1]);break;case"pageview":S();break;case"identify":Le(t[0],t[1]);break;case"reset-identify":s.identifiedUser=null,d("Identity reset");break;case"opt-out":$(`${v}optout`,"1"),a.skopos=()=>{};break;case"opt-in":H(`${v}optout`);try{b.reload()}catch(n){}break;case"debug":f.debug=t[0]!==!1;break;default:O("Unknown command:",e)}}function ae(){var n;if(s.initialized)return;if(F(`${v}optout`)==="1"){d("User opted out"),a.skopos=()=>{};return}if(Ee()){d("Bot detected, skipping"),a.skopos=()=>{};return}s.initialized=!0;const e=((n=a.skopos)==null?void 0:n.q)||[];if(a.skopos=oe,Ie(),f.autoTrack){c.readyState==="complete"?S(!0):a.addEventListener("load",()=>S(!0),{once:!0});const r=M.pushState;M.pushState=function(...o){U("navigate");const u=r.apply(this,o);return D(),setTimeout(S,0),u};const i=M.replaceState;M.replaceState=function(...o){const u=i.apply(this,o);return setTimeout(S,0),u},a.addEventListener("popstate",()=>{U("navigate"),D(),S()}),f.hashMode&&a.addEventListener("hashchange",()=>{U("navigate"),D(),S()})}if(c.addEventListener("visibilitychange",()=>{c.hidden?(se(),s.isVisible=!1,z(!0),x(!0)):(s.isVisible=!0,s.lastActiveTime=Date.now())}),a.addEventListener("pagehide",()=>{U("leave"),x(!0)}),a.addEventListener("beforeunload",()=>{U("leave"),x(!0)}),f.trackErrors&&(a.addEventListener("error",r=>{var i,o;if(r instanceof ErrorEvent){const u=r.message||((i=r.error)==null?void 0:i.message)||"Unknown error",l=((o=r.error)==null?void 0:o.stack)||"";B(u,l,r.filename,r.lineno,r.colno)}else if(r.target&&(r.target.tagName==="SCRIPT"||r.target.tagName==="LINK"||r.target.tagName==="IMG")){const u=r.target.src||r.target.href||"unknown";B(`Failed to load ${r.target.tagName.toLowerCase()}: ${u}`,"",u,0,0)}},!0),a.addEventListener("unhandledrejection",r=>{const i=r==null?void 0:r.reason;let o,u;i instanceof Error?(o=i.message||"Unhandled promise rejection",u=i.stack||""):(o=i!=null?String(i):"Unhandled promise rejection",u=""),B(o,u)})),(f.trackOutbound||f.trackDownloads)&&c.addEventListener("click",Ue,!0),f.trackErrors){c.addEventListener("click",xe,!0),c.addEventListener("change",_e,!0);const r=console.error;console.error=(...o)=>{try{const u=o.map(l=>{try{return typeof l=="object"?JSON.stringify(l):String(l)}catch(g){return"[unserializable]"}}).join(" ");A(T.CONSOLE,`console.error: ${u.slice(0,200)}`)}catch(u){}return r.apply(console,o)};const i=console.warn;console.warn=(...o)=>{try{const u=o.map(l=>{try{return typeof l=="object"?JSON.stringify(l):String(l)}catch(g){return"[unserializable]"}}).join(" ");A(T.CONSOLE,`console.warn: ${u.slice(0,200)}`)}catch(u){}return i.apply(console,o)}}const t=()=>{c.body&&j(c.body)};c.readyState==="loading"?c.addEventListener("DOMContentLoaded",t):t(),typeof MutationObserver=="function"&&c.body&&new MutationObserver(i=>{var o;for(const u of i)if(u.addedNodes){for(const l of u.addedNodes)if(l.nodeType===Node.ELEMENT_NODE){if((o=l.hasAttribute)!=null&&o.call(l,"skopos-event"))j(l.parentElement||c.body);else if(l.querySelector)try{l.querySelector("[skopos-event]")&&j(l)}catch(g){}}}}).observe(c.body,{childList:!0,subtree:!0});for(const r of e)(Array.isArray(r)||r&&typeof r.length=="number"&&typeof r[0]!="undefined")&&oe(...Array.from(r));d("Initialized with config:",f)}const Me=((ce=a.skopos)==null?void 0:ce.q)||[];a.skopos=(...e)=>{a.skopos.q=a.skopos.q||[],a.skopos.q.push(e)},a.skopos.q=Me,c.readyState==="loading"?c.addEventListener("DOMContentLoaded",ae,{once:!0}):ae()})(window,document,navigator,location,history);
